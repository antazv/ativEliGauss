<!DOCTYPE html>
<html>
<head>
  <title>LU + Permutação</title>
  <script>
    function performLU() {
      // Get input values
      var matrix = [];
      var size = parseInt(document.getElementById("size").value);

      // Read input matrix
      for (var i = 0; i < size; i++) {
        matrix[i] = [];
        for (var j = 0; j < size; j++) {
          matrix[i][j] = parseFloat(document.getElementById("elem-" + i + "-" + j).value);
        }
      }

      var { L, U, P } = decomposeLU(matrix);

      // Display the result
      var result = document.getElementById("result");
      result.innerHTML = "Matriz L:<br>" + matrixToString(L) + "<br><br>" +
                         "Matriz U:<br>" + matrixToString(U) + "<br><br>" +
                         "Matriz Permutada:<br>" + matrixToString(P);
    }

    function matrixToString(matrix) {
      return matrix.map(row => row.join("\t")).join("<br>");
    }

    function decomposeLU(matrix) {
      var n = matrix.length;
      var L = [];
      var U = [];
      var P = [];

      for (var i = 0; i < n; i++) {
        L[i] = [];
        U[i] = [];
        P[i] = [];
        for (var j = 0; j < n; j++) {
          if (i === j) {
            L[i][j] = 1;
          } else {
            L[i][j] = 0;
          }
          U[i][j] = matrix[i][j];
          P[i][j] = (i === j) ? 1 : 0;
        }
      }

      for (var j = 0; j < n; j++) {
        var maxRow = j;

        for (var i = j + 1; i < n; i++) {
          if (Math.abs(U[i][j]) > Math.abs(U[maxRow][j])) {
            maxRow = i;
          }
        }

        // Swap rows in matrices U and P
        [U[j], U[maxRow]] = [U[maxRow], U[j]];
        [P[j], P[maxRow]] = [P[maxRow], P[j]];

        // Apply row operations to matrices L and U
        for (var i = j + 1; i < n; i++) {
          var ratio = U[i][j] / U[j][j];
          L[i][j] = ratio;
          for (var k = j; k < n; k++) {
            U[i][k] -= ratio * U[j][k];
          }
        }
      }

      return { L, U, P };
    }
  </script>
</head>
<body>
  <h1>LU + Permutação</h1>
  <form>
    <label for="size">Ordem Matriz:</label>
    <input type="number" id="size" min="1" max="10" required><br>
    <div id="matrix-inputs"></div>
    <button type="button" onclick="performLU()">Resolver</button>
  </form>
  <div id="result"></div>

  <script>
    // Generate matrix input fields dynamically based on size
    document.getElementById("size").addEventListener("change", function() {
      var size = parseInt(this.value);
      var matrixInputs = document.getElementById("matrix-inputs");
      matrixInputs.innerHTML = "";

      for (var i = 0; i < size; i++) {
        for (var j = 0; j < size; j++) {
          var input = document.createElement("input");
          input.type = "number";
          input.id = "elem-" + i + "-" + j;
          input.required = true;
          matrixInputs.appendChild(input);
        }
        matrixInputs.appendChild(document.createElement("br"));
      }
    });
  </script>
</body>
</html>
